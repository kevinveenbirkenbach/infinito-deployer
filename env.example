# =========================
# Global
# =========================
APP_ENV=production
NODE_ENV=production
RESTART_POLICY=unless-stopped

DOCKER_NETWORK_NAME=infinito-deployer

# =========================
# API service
# =========================
API_CONTAINER_NAME=infinito-deployer-api
API_BUILD_CONTEXT=./apps/api
API_DOCKERFILE=Dockerfile

API_APP_HOST=0.0.0.0
API_APP_PORT=8000
API_PORT=8000

API_HEALTHCHECK_INTERVAL=10s
API_HEALTHCHECK_TIMEOUT=3s
API_HEALTHCHECK_RETRIES=10

# Comma-separated list of allowed origins for the API (CORS)
# Example:
#   CORS_ALLOW_ORIGINS=http://localhost:3000,https://my-ui.example
CORS_ALLOW_ORIGINS=http://localhost:3000

# =========================
# Web service
# =========================
WEB_CONTAINER_NAME=infinito-deployer-web
WEB_BUILD_CONTEXT=./apps/web
WEB_DOCKERFILE=Dockerfile

WEB_PORT=3000
# Browser-side API base URL override. Leave empty to use same-origin /api proxy.
# NEXT_PUBLIC_API_BASE_URL=https://api.example.com
NEXT_PUBLIC_API_BASE_URL=

# Internal target used by the web container for /api proxy rewrites.
API_PROXY_TARGET=http://api:8000

# =========================
# Paths / Volumes
# =========================
# Host path to your Infinito.Nexus repository
INFINITO_REPO_HOST_PATH=./infinito-nexus
INFINITO_REPO_PATH=/repo/infinito-nexus

# Persistent job/log/sqlite state
# NOTE: when JOB_RUNNER_BACKEND=container, STATE_HOST_PATH must be an absolute path.
STATE_HOST_PATH=./state
STATE_DIR=/state

# Optional Docker socket passthrough
DOCKER_SOCKET_PATH=/var/run/docker.sock

# =========================
# Infinito.Nexus Catalog (generated)
# =========================

# Infinito.Nexus image used for catalog generation
INFINITO_NEXUS_IMAGE=ghcr.io/kevinveenbirkenbach/infinito-debian:latest

# Where the generated catalog is stored (inside deployer stack)
CATALOG_DIR=/state/catalog

# Strict source for roles list (must exist)
ROLE_CATALOG_LIST_JSON=/state/catalog/roles/list.json

# Optional: categories are read from the mounted repo (read-only)
ROLE_CATALOG_CATEGORIES_YML=/repo/infinito-nexus/roles/categories.yml

# Default forum URL used when role metadata has no forum link

# =========================
# Job Runner (optional container backend)
# =========================
# local  -> run CLI inside API container (default)
# container -> run one Infinito.Nexus container per job (requires Docker socket)
JOB_RUNNER_BACKEND=local

# Image used for job containers (defaults to INFINITO_NEXUS_IMAGE if unset)
JOB_RUNNER_IMAGE=

# Repo path inside job container (default: /opt/src/infinito)
JOB_RUNNER_REPO_DIR=/opt/src/infinito

# Workspace mount point inside job container (default: /workspace)
JOB_RUNNER_WORKDIR=/workspace

# Optional: mount host repo into container (must be absolute path)
JOB_RUNNER_REPO_HOST_PATH=

# Extra docker args for job containers (e.g. "--pull always --read-only")
JOB_RUNNER_DOCKER_ARGS=
JOB_RUNNER_DOCKER_BIN=

# Optional: disable cleanup/build inside CLI
JOB_RUNNER_SKIP_CLEANUP=false
JOB_RUNNER_SKIP_BUILD=false
